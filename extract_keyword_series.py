from datetime import datetime

a = {
    "code": "OK",
    "message": '',
    "data": [
        {
            "keywordCn": "格林奇派对装饰品",
            "searches": [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                10844,
                7632,
                0,
                12723,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                2026,
                7218,
                7385,
                0,
                0,
                0,
                0,
                0,
                541,
                0,
                0,
                1184,
                2637,
                8326,
                9863,
                0,
                0,
                0,
                0,
                0,
                0,
                575,
                575,
                922,
                4214,
                21437,
                23826,
                1984,
                576,
                0,
                0,
                0,
                0,
                793,
                1608,
                3589,
                7751,
                20021,
                23534,
                3208,
                1379,
                0,
                0,
                0,
                369,
                714,
                2309,
                4120,
                14810,
                61220,
                64123,
                2932,
                1337,
                637,
                616,
                754,
                722,
                1556,
                2522,
                4809,
                16264,
                54534,
                67706,
                2151,
                700,
                621,
                482,
                0,
                140,
                1570,
                2280,
                4182,
                11829,
                51028
            ],
            "months": [
                "2017-01",
                "2017-02",
                "2017-03",
                "2017-04",
                "2017-05",
                "2017-06",
                "2017-07",
                "2017-08",
                "2017-09",
                "2017-10",
                "2017-11",
                "2017-12",
                "2018-01",
                "2018-02",
                "2018-03",
                "2018-04",
                "2018-05",
                "2018-06",
                "2018-07",
                "2018-08",
                "2018-09",
                "2018-10",
                "2018-11",
                "2018-12",
                "2019-01",
                "2019-02",
                "2019-03",
                "2019-04",
                "2019-05",
                "2019-06",
                "2019-07",
                "2019-08",
                "2019-09",
                "2019-10",
                "2019-11",
                "2019-12",
                "2020-01",
                "2020-02",
                "2020-03",
                "2020-04",
                "2020-05",
                "2020-06",
                "2020-07",
                "2020-08",
                "2020-09",
                "2020-10",
                "2020-11",
                "2020-12",
                "2021-01",
                "2021-02",
                "2021-03",
                "2021-04",
                "2021-05",
                "2021-06",
                "2021-07",
                "2021-08",
                "2021-09",
                "2021-10",
                "2021-11",
                "2021-12",
                "2022-01",
                "2022-02",
                "2022-03",
                "2022-04",
                "2022-05",
                "2022-06",
                "2022-07",
                "2022-08",
                "2022-09",
                "2022-10",
                "2022-11",
                "2022-12",
                "2023-01",
                "2023-02",
                "2023-03",
                "2023-04",
                "2023-05",
                "2023-06",
                "2023-07",
                "2023-08",
                "2023-09",
                "2023-10",
                "2023-11",
                "2023-12",
                "2024-01",
                "2024-02",
                "2024-03",
                "2024-04",
                "2024-05",
                "2024-06",
                "2024-07",
                "2024-08",
                "2024-09",
                "2024-10",
                "2024-11",
                "2024-12",
                "2025-01",
                "2025-02",
                "2025-03",
                "2025-04",
                "2025-05",
                "2025-06",
                "2025-07",
                "2025-08",
                "2025-09",
                "2025-10",
                "2025-11"
            ],
            "keywordJp": "グリンチパーティーの装飾",
            "keyword": "grinch party decorations"
        },
        {
            "keywordCn": "格林奇装饰品",
            "searches": [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                26638,
                22865,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                16087,
                39502,
                241810,
                132598,
                0,
                0,
                0,
                0,
                0,
                0,
                1667,
                2539,
                5637,
                12238,
                67151,
                55838,
                1951,
                0,
                0,
                635,
                517,
                528,
                2075,
                3031,
                11375,
                35355,
                162071,
                74375,
                6467,
                1278,
                936,
                1256,
                987,
                2193,
                5180,
                7748,
                18039,
                67759,
                268497,
                126668,
                9770,
                2151,
                1450,
                1526,
                1947,
                3335,
                9506,
                13463,
                16326,
                35784,
                186325,
                93923,
                8221,
                1675,
                1342,
                917,
                1963,
                2614,
                5220,
                16444,
                25416,
                49888,
                160115,
                80169,
                3785,
                1243,
                935,
                1362,
                1351,
                1901,
                3477,
                6904,
                13913,
                38366,
                121840,
                69718,
                3105,
                641,
                140,
                762,
                698,
                1401,
                3164,
                5430,
                20078,
                50232,
                158884
            ],
            "months": [
                "2017-01",
                "2017-02",
                "2017-03",
                "2017-04",
                "2017-05",
                "2017-06",
                "2017-07",
                "2017-08",
                "2017-09",
                "2017-10",
                "2017-11",
                "2017-12",
                "2018-01",
                "2018-02",
                "2018-03",
                "2018-04",
                "2018-05",
                "2018-06",
                "2018-07",
                "2018-08",
                "2018-09",
                "2018-10",
                "2018-11",
                "2018-12",
                "2019-01",
                "2019-02",
                "2019-03",
                "2019-04",
                "2019-05",
                "2019-06",
                "2019-07",
                "2019-08",
                "2019-09",
                "2019-10",
                "2019-11",
                "2019-12",
                "2020-01",
                "2020-02",
                "2020-03",
                "2020-04",
                "2020-05",
                "2020-06",
                "2020-07",
                "2020-08",
                "2020-09",
                "2020-10",
                "2020-11",
                "2020-12",
                "2021-01",
                "2021-02",
                "2021-03",
                "2021-04",
                "2021-05",
                "2021-06",
                "2021-07",
                "2021-08",
                "2021-09",
                "2021-10",
                "2021-11",
                "2021-12",
                "2022-01",
                "2022-02",
                "2022-03",
                "2022-04",
                "2022-05",
                "2022-06",
                "2022-07",
                "2022-08",
                "2022-09",
                "2022-10",
                "2022-11",
                "2022-12",
                "2023-01",
                "2023-02",
                "2023-03",
                "2023-04",
                "2023-05",
                "2023-06",
                "2023-07",
                "2023-08",
                "2023-09",
                "2023-10",
                "2023-11",
                "2023-12",
                "2024-01",
                "2024-02",
                "2024-03",
                "2024-04",
                "2024-05",
                "2024-06",
                "2024-07",
                "2024-08",
                "2024-09",
                "2024-10",
                "2024-11",
                "2024-12",
                "2025-01",
                "2025-02",
                "2025-03",
                "2025-04",
                "2025-05",
                "2025-06",
                "2025-07",
                "2025-08",
                "2025-09",
                "2025-10",
                "2025-11"
            ],
            "keywordJp": "グリンチデコレーション",
            "keyword": "grinch decorations"
        },
        {
            "keywordCn": "圣诞装饰品",
            "searches": [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                30535,
                128890,
                82035,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                13117,
                70546,
                35394,
                0,
                0,
                0,
                0,
                0,
                1361,
                3814,
                6550,
                24836,
                68462,
                322642,
                191594,
                6717,
                0,
                948,
                658,
                2548,
                1807,
                5247,
                13734,
                58514,
                163670,
                625988,
                279771,
                14213,
                2155,
                1187,
                1844,
                3474,
                6905,
                15063,
                26378,
                76206,
                265268,
                832873,
                378278,
                26641,
                4240,
                2981,
                4604,
                5912,
                11045,
                29369,
                64053,
                128680,
                324273,
                1120817,
                511218,
                37909,
                7997,
                4778,
                5482,
                5378,
                12439,
                24655,
                86859,
                177866,
                370334,
                1332640,
                417609,
                43744,
                9261,
                9295,
                8655,
                9980,
                23188,
                50701,
                94861,
                171563,
                351848,
                920260,
                371111,
                26902,
                5090,
                3680,
                4475,
                7596,
                14852,
                34076,
                58731,
                112284,
                239809,
                1059041
            ],
            "months": [
                "2017-01",
                "2017-02",
                "2017-03",
                "2017-04",
                "2017-05",
                "2017-06",
                "2017-07",
                "2017-08",
                "2017-09",
                "2017-10",
                "2017-11",
                "2017-12",
                "2018-01",
                "2018-02",
                "2018-03",
                "2018-04",
                "2018-05",
                "2018-06",
                "2018-07",
                "2018-08",
                "2018-09",
                "2018-10",
                "2018-11",
                "2018-12",
                "2019-01",
                "2019-02",
                "2019-03",
                "2019-04",
                "2019-05",
                "2019-06",
                "2019-07",
                "2019-08",
                "2019-09",
                "2019-10",
                "2019-11",
                "2019-12",
                "2020-01",
                "2020-02",
                "2020-03",
                "2020-04",
                "2020-05",
                "2020-06",
                "2020-07",
                "2020-08",
                "2020-09",
                "2020-10",
                "2020-11",
                "2020-12",
                "2021-01",
                "2021-02",
                "2021-03",
                "2021-04",
                "2021-05",
                "2021-06",
                "2021-07",
                "2021-08",
                "2021-09",
                "2021-10",
                "2021-11",
                "2021-12",
                "2022-01",
                "2022-02",
                "2022-03",
                "2022-04",
                "2022-05",
                "2022-06",
                "2022-07",
                "2022-08",
                "2022-09",
                "2022-10",
                "2022-11",
                "2022-12",
                "2023-01",
                "2023-02",
                "2023-03",
                "2023-04",
                "2023-05",
                "2023-06",
                "2023-07",
                "2023-08",
                "2023-09",
                "2023-10",
                "2023-11",
                "2023-12",
                "2024-01",
                "2024-02",
                "2024-03",
                "2024-04",
                "2024-05",
                "2024-06",
                "2024-07",
                "2024-08",
                "2024-09",
                "2024-10",
                "2024-11",
                "2024-12",
                "2025-01",
                "2025-02",
                "2025-03",
                "2025-04",
                "2025-05",
                "2025-06",
                "2025-07",
                "2025-08",
                "2025-09",
                "2025-10",
                "2025-11"
            ],
            "keywordJp": "グリンチクリスマスデコレーション",
            "keyword": "grinch christmas decorations"
        },
        {
            "keywordCn": "格林奇桌布",
            "searches": [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                2466,
                3117,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1240,
                776,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                758,
                3511,
                3045,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1194,
                3569,
                20673,
                14594,
                1907,
                640,
                0,
                0,
                0,
                0,
                620,
                1169,
                2461,
                4171,
                15988,
                10055,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                421,
                3152,
                12976,
                52063,
                47172,
                1644,
                0,
                0,
                0,
                0,
                0,
                140,
                947,
                2765,
                9094,
                52785
            ],
            "months": [
                "2017-01",
                "2017-02",
                "2017-03",
                "2017-04",
                "2017-05",
                "2017-06",
                "2017-07",
                "2017-08",
                "2017-09",
                "2017-10",
                "2017-11",
                "2017-12",
                "2018-01",
                "2018-02",
                "2018-03",
                "2018-04",
                "2018-05",
                "2018-06",
                "2018-07",
                "2018-08",
                "2018-09",
                "2018-10",
                "2018-11",
                "2018-12",
                "2019-01",
                "2019-02",
                "2019-03",
                "2019-04",
                "2019-05",
                "2019-06",
                "2019-07",
                "2019-08",
                "2019-09",
                "2019-10",
                "2019-11",
                "2019-12",
                "2020-01",
                "2020-02",
                "2020-03",
                "2020-04",
                "2020-05",
                "2020-06",
                "2020-07",
                "2020-08",
                "2020-09",
                "2020-10",
                "2020-11",
                "2020-12",
                "2021-01",
                "2021-02",
                "2021-03",
                "2021-04",
                "2021-05",
                "2021-06",
                "2021-07",
                "2021-08",
                "2021-09",
                "2021-10",
                "2021-11",
                "2021-12",
                "2022-01",
                "2022-02",
                "2022-03",
                "2022-04",
                "2022-05",
                "2022-06",
                "2022-07",
                "2022-08",
                "2022-09",
                "2022-10",
                "2022-11",
                "2022-12",
                "2023-01",
                "2023-02",
                "2023-03",
                "2023-04",
                "2023-05",
                "2023-06",
                "2023-07",
                "2023-08",
                "2023-09",
                "2023-10",
                "2023-11",
                "2023-12",
                "2024-01",
                "2024-02",
                "2024-03",
                "2024-04",
                "2024-05",
                "2024-06",
                "2024-07",
                "2024-08",
                "2024-09",
                "2024-10",
                "2024-11",
                "2024-12",
                "2025-01",
                "2025-02",
                "2025-03",
                "2025-04",
                "2025-05",
                "2025-06",
                "2025-07",
                "2025-08",
                "2025-09",
                "2025-10",
                "2025-11"
            ],
            "keywordJp": "グリンチテーブルクロス",
            "keyword": "grinch table cloth"
        },
        {
            "keywordCn": "格林盘子",
            "searches": [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                7411,
                8375,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1801,
                5869,
                8117,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                568,
                2307,
                7404,
                8638,
                901,
                0,
                0,
                0,
                0,
                0,
                754,
                0,
                923,
                4055,
                13252,
                15337,
                1104,
                578,
                0,
                0,
                0,
                0,
                615,
                766,
                2003,
                5683,
                15926,
                17282,
                2538,
                0,
                0,
                0,
                0,
                0,
                246,
                1231,
                2958,
                7492,
                30545,
                38959,
                2103,
                0,
                0,
                0,
                545,
                0,
                438,
                656,
                2293,
                7785,
                29335,
                40743,
                1251,
                0,
                0,
                0,
                0,
                0,
                140,
                518,
                1744,
                4184,
                24393
            ],
            "months": [
                "2017-01",
                "2017-02",
                "2017-03",
                "2017-04",
                "2017-05",
                "2017-06",
                "2017-07",
                "2017-08",
                "2017-09",
                "2017-10",
                "2017-11",
                "2017-12",
                "2018-01",
                "2018-02",
                "2018-03",
                "2018-04",
                "2018-05",
                "2018-06",
                "2018-07",
                "2018-08",
                "2018-09",
                "2018-10",
                "2018-11",
                "2018-12",
                "2019-01",
                "2019-02",
                "2019-03",
                "2019-04",
                "2019-05",
                "2019-06",
                "2019-07",
                "2019-08",
                "2019-09",
                "2019-10",
                "2019-11",
                "2019-12",
                "2020-01",
                "2020-02",
                "2020-03",
                "2020-04",
                "2020-05",
                "2020-06",
                "2020-07",
                "2020-08",
                "2020-09",
                "2020-10",
                "2020-11",
                "2020-12",
                "2021-01",
                "2021-02",
                "2021-03",
                "2021-04",
                "2021-05",
                "2021-06",
                "2021-07",
                "2021-08",
                "2021-09",
                "2021-10",
                "2021-11",
                "2021-12",
                "2022-01",
                "2022-02",
                "2022-03",
                "2022-04",
                "2022-05",
                "2022-06",
                "2022-07",
                "2022-08",
                "2022-09",
                "2022-10",
                "2022-11",
                "2022-12",
                "2023-01",
                "2023-02",
                "2023-03",
                "2023-04",
                "2023-05",
                "2023-06",
                "2023-07",
                "2023-08",
                "2023-09",
                "2023-10",
                "2023-11",
                "2023-12",
                "2024-01",
                "2024-02",
                "2024-03",
                "2024-04",
                "2024-05",
                "2024-06",
                "2024-07",
                "2024-08",
                "2024-09",
                "2024-10",
                "2024-11",
                "2024-12",
                "2025-01",
                "2025-02",
                "2025-03",
                "2025-04",
                "2025-05",
                "2025-06",
                "2025-07",
                "2025-08",
                "2025-09",
                "2025-10",
                "2025-11"
            ],
            "keywordJp": "グリンチプレート",
            "keyword": "grinch plates"
        }
    ],
    "success": True
}


def extract_keyword_series(keyword_searches):
    new_data = {}
    # start_time = None
    # end_time = None
    start_month_str = None
    end_month_str = None

    for item in keyword_searches.get("data", []):
        keyword = item.get("keyword")
        searches = item.get("searches")
        months = item.get("months")

        # 当前年月
        now = datetime.now()
        current_year = now.year
        current_month = now.month
        end_month_str = f'{current_year}-{current_month-1}'

        # 如果不足 3 年，全部保留
        first_year = int(months[0][:4])
        if current_year - first_year + 1 < 3:
            new_data[keyword] = searches
            continue

        # 计算三年前的起始年份（从 1 月开始）
        start_year = current_year - 2
        start_month_str = f"{start_year}-01"

        # 找到对应索引
        if start_month_str in months:
            start_index = months.index(start_month_str)
        else:
            # 防御性处理：如果不存在，取最接近的
            start_index = 0
            for i, m in enumerate(months):
                if m >= start_month_str:
                    start_index = i
                    break

        # 截取近三年
        new_data[keyword] = searches[start_index:]

    return new_data, start_month_str, end_month_str


if __name__ == '__main__':
    print(extract_keyword_series(a))